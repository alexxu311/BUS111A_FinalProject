#check in packages
library(gapminder)
library(dplyr)
library(ggplot2)
library(rmarkdown)
library(data.table)

#read the file into rstudio
BlackFriday <- read.csv('BlackFriday.csv', header = T)

#setting variable types as factor 
BlackFriday$User_ID <- as.factor(BlackFriday$User_ID)
BlackFriday$Product_Category_1 <- as.factor(BlackFriday$Product_Category_1)
BlackFriday$Occupation <- as.factor(BlackFriday$Occupation)
BlackFriday$Marital_Status <- as.factor(BlackFriday$Marital_Status)

#look for missing values
sapply(BlackFriday, function(y) sum(length(which(is.na(y)))))
#Or
colSums(is.na(BlackFriday))

#eliminate variabels Procduct_Category_1,Product_Category_2,Product_Category_3,Occupation, and Product_ID
BlackFriday[,c("Product_Category_2","Product_Category_3","Product_Category_1","Product_ID","Occupation")] <- NULL

# combine rows based on User_ID and sum up purchase for each consumer
a1 <- aggregate(Purchase ~ User_ID, FUN = sum, BlackFriday)
new <- BlackFriday %>% distinct(User_ID, .keep_all = TRUE) 
new[,8] <- a1[,2]

#Data Visualization by City_Category
ggplot(new, aes(x=City_Category, y=Purchase,col=City_Category))+geom_col()+
  ggtitle("Total Black Friday Purchase across Cities")+ xlab("City Category") + ylab("Dollar Amount Purchase")+
  theme(plot.title = element_text(hjust = 0.5,size = 12))

ggplot(new, aes(x=City_Category, y=Purchase,col = City_Category))+geom_boxplot()+
  ggtitle("Distribution of Black Friday Purchase across Cities")+ xlab("City Category") + ylab("Dollar Amount Purchase")+
  theme(plot.title = element_text(hjust = 0.5,size = 12))

# Statistics and Data Visualization by City and Stay_In_Current_City_Years
ggplot(new, aes(x = Stay_In_Current_City_Years, y = Purchase,col=Stay_In_Current_City_Years))+ geom_col()+
  facet_wrap(~City_Category)+ ggtitle("Histogram of Cities and Years customers stayed in cities ~ Purchase")+
  theme(plot.title = element_text(hjust = 0.5,size = 12)) + xlab("Years customers stayed in cities")

# Statistics and Data Visualization by Marital Status
ggplot(new,aes(x = Marital_Status, y= Purchase,col=Marital_Status))+ geom_col()+facet_wrap(~Gender)+ggtitle("Histogram of Gender, Marital status ~ Purchase")+
  theme(plot.title = element_text(hjust = 0.5,size = 12)) + xlab("Marital Status")

# Statistics and Data Visualization of age and gender
ggplot(new, aes(x = Age, y = Purchase,color=Gender)) + geom_boxplot() + ggtitle("Boxplot of Age and Gender ~ Purchase")+
  theme(plot.title = element_text(hjust = 0.5,size = 12))

ggplot(new, aes(x= Age,y=Purchase,color=Age)) + geom_col() + facet_wrap(~ Gender) +
  theme(axis.text = element_text(size = 5))+ ggtitle("Boxplot of Age and Gender ~ Purchase") +
  theme(plot.title = element_text(hjust = 0.5,size = 12))
