#set working directory
setwd('C:/Users/Surface Pro 4/Desktop/BUS111A')
getwd()

#check in packages
library(gapminder)
library(dplyr)
library(ggplot2)
library(rmarkdown)
library(data.table)

#read the file into rstudio
BlackFriday <- read.csv('BlackFriday.csv', header = T)

#setting variable types as factor 
BlackFriday$User_ID <- as.factor(BlackFriday$User_ID)
BlackFriday$Product_Category_1 <- as.factor(BlackFriday$Product_Category_1)
BlackFriday$Occupation <- as.factor(BlackFriday$Occupation)
BlackFriday$Marital_Status <- as.factor(BlackFriday$Marital_Status)

#look for missing values
sapply(BlackFriday, function(y) sum(length(which(is.na(y)))))
#Or
colSums(is.na(BlackFriday))

#eliminate variabels Procduct_Category_1,Product_Category_2,Product_Category_3,Occupation, and Product_ID
BlackFriday[,c("Product_Category_2","Product_Category_3","Product_Category_1","Product_ID","Occupation")] <- NULL

# combine rows based on User_ID and sum up purchase for each consumer
a1 <- aggregate(Purchase ~ User_ID, FUN = sum, BlackFriday)
new <- BlackFriday %>% distinct(User_ID, .keep_all = TRUE) 
new[,8] <- a1[,2]

# Statistics and Data Visualization by City and Stay_In_Current_City_Years
ggplot(new, aes(x = Stay_In_Current_City_Years, y = Purchase))+ geom_col()+
  facet_wrap(~City_Category)+ ggtitle("The relationship between cities and years customers stayed in cities and amount of purchase")+
  theme(plot.title = element_text(hjust = 0.5,size = 12)) + xlab("Years customers stayed in cities")

#Statistics and Data Visualization by Marital Status
ggplot(new,aes(x = Marital_Status, y= Purchase))+ geom_col()+facet_wrap(~Gender)+ggtitle("The relationship between gender and marital status and amount of purchse")+
  theme(plot.title = element_text(hjust = 0.5,size = 12)) + xlab("Marital Status")

#Data Visualization by City_Category
ggplot(new, aes(x=new$City_Category, y=new$Purchase))+geom_col()+
  ggtitle("Total Black Friday Purchase across Cities")+ xlab("City Category") + ylab("Dollar Amount Purchase")+
  theme(plot.title = element_text(hjust = 0.5,size = 12))

ggplot(new, aes(x=new$City_Category, y=new$Purchase))+geom_boxplot()+
  ggtitle("Distribution of Black Friday Purchase across Cities")+ xlab("City Category") + ylab("Dollar Amount Purchase")+
  theme(plot.title = element_text(hjust = 0.5,size = 12))
  
ggplot(new, aes(x = Gender, y = Purchase)) + geom_boxplot() + ylab('Total amount of purchase') +
  ggtitle('The Distribution of Total Purchase between Gender')
  
ggplot(new, aes(x=Gender,y=Purchase)) + geom_col() 

ggplot(new, aes(x =Age, y = Purchase)) + geom_boxplot() 

ggplot(new, aes(x=Age,y=Purchase)) + geom_col() 


ggplot(new, aes(x = Age, y = Purchase,color=Gender)) + geom_boxplot() 

ggplot(new, aes(x= Age,y=Purchase,color=Age)) + geom_col() + facet_wrap(~ Gender) +
  theme(axis.text = element_text(size = 5))
